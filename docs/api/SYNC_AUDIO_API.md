# üéß –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ–≥–∏–¥–∞

## –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä—É—á–∫–∞ –¥–ª—è **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π** –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞—É–¥–∏–æ–≥–∏–¥–∞ - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∞—Ä—à—Ä—É—Ç–∞, –ø–æ–ª—É—á–∞–µ—Ç–µ –≥–æ—Ç–æ–≤—ã–π MP3 —Ñ–∞–π–ª.

---

## üöÄ –≠–Ω–¥–ø–æ–∏–Ω—Ç

```
POST /api/routes/generate-audio
```

### –ó–∞–ø—Ä–æ—Å

**Content-Type:** `application/json`

```json
{
  "start_point": {
    "lat": 55.7558,
    "lon": 37.6173
  },
  "duration_minutes": 60,
  "epochs": ["soviet", "medieval"],
  "interests": ["architecture", "history"],
  "max_waypoints": 3
}
```

### –û—Ç–≤–µ—Ç

**Content-Type:** `audio/mpeg`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç MP3 —Ñ–∞–π–ª —Å –∞—É–¥–∏–æ–≥–∏–¥–æ–º –¥–ª—è –≤—Å–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞.

---

## ‚ö° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

| –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± | –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–± |
|---------------|--------------|
| 1. POST /routes/generate ‚Üí route_id | 1. POST /routes/generate-audio ‚Üí MP3 |
| 2. –ñ–¥–∞—Ç—å 2-3 –º–∏–Ω—É—Ç—ã | |
| 3. GET /routes/:id/audio ‚Üí MP3 | |
| **3 —à–∞–≥–∞, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** | **1 —à–∞–≥, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** |

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä

```bash
curl -X POST http://localhost:8080/api/routes/generate-audio \
  -H "Content-Type: application/json" \
  -d '{
    "start_point": {"lat": 55.7558, "lon": 37.6173},
    "duration_minutes": 60,
    "epochs": ["soviet"],
    "interests": ["architecture"],
    "max_waypoints": 3
  }' \
  -o my_audio_guide.mp3

# –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
afplay my_audio_guide.mp3
```

### –° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–∫—Ä–∏–ø—Ç–∞

```bash
# –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫ (–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
./generate_audio_route.sh

# –° –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
./generate_audio_route.sh 55.7558 37.6173 90 '["soviet","medieval"]' '["architecture","history"]' 4
```

### –° –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

```bash
# –°–æ–≤–µ—Ç—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, 60 –º–∏–Ω—É—Ç, 3 —Ç–æ—á–∫–∏
./generate_audio_route.sh 55.7558 37.6173 60 '["soviet"]' '["architecture"]' 3

# –°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤–∞—è –∏—Å—Ç–æ—Ä–∏—è, 90 –º–∏–Ω—É—Ç, 5 —Ç–æ—á–µ–∫
./generate_audio_route.sh 55.7539 37.6208 90 '["medieval"]' '["history"]' 5
```

---

## ‚è±Ô∏è –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–ó–∞–ø—Ä–æ—Å **—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π** - —Å–µ—Ä–≤–µ—Ä –∂–¥–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö –∞—É–¥–∏–æ –∏ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

- **1 —Ç–æ—á–∫–∞** = ~30-60 —Å–µ–∫—É–Ω–¥
- **3 —Ç–æ—á–∫–∏** = ~2-3 –º–∏–Ω—É—Ç—ã
- **5 —Ç–æ—á–µ–∫** = ~3-5 –º–∏–Ω—É—Ç

**–í–∞–∂–Ω–æ:** –ù–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ –≤—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏!

---

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

```
1. –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∞—Ä—à—Ä—É—Ç–∞
   ‚Üì
2. –°–µ—Ä–≤–µ—Ä –Ω–∞—Ö–æ–¥–∏—Ç POI –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º
   ‚Üì
3. –î–ª—è –∫–∞–∂–¥–æ–π —Ç–æ—á–∫–∏:
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç (YandexGPT)
   - –°–æ–∑–¥–∞–µ—Ç –∞—É–¥–∏–æ (Yandex TTS)
   - –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –ë–î
   ‚Üì
4. –û–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ MP3 –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª
   ‚Üì
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π –∞—É–¥–∏–æ–≥–∏–¥
```

**–í—Å–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ!**

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º API

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π)

```bash
# –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç
curl -X POST /api/routes/generate -d '{...}' 
# ‚Üí {"route_id": "xxx"}

# –®–∞–≥ 2: –ü–æ–¥–æ–∂–¥–∞—Ç—å 2-3 –º–∏–Ω—É—Ç—ã
sleep 180

# –®–∞–≥ 3: –°–∫–∞—á–∞—Ç—å –∞—É–¥–∏–æ
curl /api/routes/xxx/audio -o guide.mp3
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç (—Å—Ä–∞–∑—É route_id)
- ‚úÖ –ú–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç–∞—Ç—É—Å
- ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –ù—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚ùå –ù—É–∂–Ω–æ –∂–¥–∞—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å
- ‚ùå –°–ª–æ–∂–Ω–µ–µ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

### –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π (–Ω–æ–≤—ã–π)

```bash
# –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å
curl -X POST /api/routes/generate-audio -d '{...}' -o guide.mp3
```

**–ü–ª—é—Å—ã:**
- ‚úÖ –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å
- ‚úÖ –°—Ä–∞–∑—É –≥–æ—Ç–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ –ü—Ä–æ—â–µ –¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å route_id

**–ú–∏–Ω—É—Å—ã:**
- ‚ùå –î–æ–ª–≥–∏–π –æ—Ç–≤–µ—Ç (2-5 –º–∏–Ω—É—Ç)
- ‚ùå –ù–µ–ª—å–∑—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
- ‚ùå –ú–æ–∂–µ—Ç timeout –Ω–∞ –º–µ–¥–ª–µ–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è—Ö

---

## üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API –µ—Å–ª–∏:
- –ù—É–∂–µ–Ω –ø—Ä–æ—Å—Ç–æ–π workflow
- –ì–æ—Ç–æ–≤—ã –∂–¥–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
- –ù–µ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –º–∞—Ä—à—Ä—É—Ç
- –î–µ–ª–∞–µ—Ç–µ —Ä–∞–∑–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å

### –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API –µ—Å–ª–∏:
- –ù—É–∂–µ–Ω –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç
- –•–æ—Ç–∏—Ç–µ –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
- –ù—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- –î–µ–ª–∞–µ—Ç–µ –º–∞—Å—Å–æ–≤—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é

---

## ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
export DATABASE_URL="postgresql://user:pass@host:30101/db?sslmode=disable"

# Yandex Cloud (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞—É–¥–∏–æ)
export YANDEX_API_KEY="AQVN..."
export YANDEX_FOLDER_ID="b1g..."
```

**–ë–µ–∑ Yandex API –∫–ª—é—á–µ–π –∞—É–¥–∏–æ –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è!**

---

## üêõ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### 400 Bad Request
```json
{
  "error": "Invalid request parameters"
}
```
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç JSON

### 404 Not Found
```json
{
  "error": "No POIs found matching criteria"
}
```
**–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á—å—Ç–µ `duration_minutes` –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã

### 500 Internal Server Error
```json
{
  "error": "Failed to generate content for –í–î–ù–•: API key not set"
}
```
**–†–µ—à–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `YANDEX_API_KEY` –∏ `YANDEX_FOLDER_ID`

### Timeout
–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–∏–π (>5 –º–∏–Ω—É—Ç), –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ timeout.

**–†–µ—à–µ–Ω–∏–µ:** 
- –£–º–µ–Ω—å—à–∏—Ç–µ `max_waypoints`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API

---

## üí° –°–æ–≤–µ—Ç—ã

### 1. –û–ø—Ç–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ—á–µ–∫
```json
{
  "max_waypoints": 3  // –û–ø—Ç–∏–º–∞–ª—å–Ω–æ: 2-3 –º–∏–Ω—É—Ç—ã
}
```

### 2. –£–≤–µ–ª–∏—á–µ–Ω–∏–µ timeout –≤ curl
```bash
curl --max-time 300 -X POST ...  # 5 –º–∏–Ω—É—Ç
```

### 3. –ü–æ–∫–∞–∑ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
```bash
curl --progress-bar -X POST ... -o guide.mp3
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
curl http://localhost:8080/api/health

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á–∏
echo $YANDEX_API_KEY
```

---

## üìö –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API:** [AUDIO_GUIDE_API.md](AUDIO_GUIDE_API.md)
- **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:** [QUICK_START_AUDIO.md](QUICK_START_AUDIO.md)
- **Backend README:** [backend/README.md](backend/README.md)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç

```bash
./generate_audio_route.sh
```

### –†—É—á–Ω–æ–π —Ç–µ—Å—Ç

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
cd backend
export DATABASE_URL="..."
export YANDEX_API_KEY="..."
export YANDEX_FOLDER_ID="..."
go run cmd/server/main.go

# 2. –í –¥—Ä—É–≥–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
curl -X POST http://localhost:8080/api/routes/generate-audio \
  -H "Content-Type: application/json" \
  -d '{
    "start_point": {"lat": 55.7558, "lon": 37.6173},
    "duration_minutes": 60,
    "epochs": ["soviet"],
    "interests": ["architecture"],
    "max_waypoints": 2
  }' \
  -o test_guide.mp3

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
ls -lh test_guide.mp3
afplay test_guide.mp3
```

---

## üéâ –ò—Ç–æ–≥

–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –∞—É–¥–∏–æ–≥–∏–¥ **–æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º**:

```bash
curl -X POST http://localhost:8080/api/routes/generate-audio \
  -d '{"start_point": {"lat": 55.7558, "lon": 37.6173}, "duration_minutes": 60, "epochs": ["soviet"], "interests": ["architecture"]}' \
  -o guide.mp3
```

**–ü—Ä–æ—Å—Ç–æ, –±—ã—Å—Ç—Ä–æ, —É–¥–æ–±–Ω–æ!** üöÄ
