# üìù –°–≤–æ–¥–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π - –ê—É–¥–∏–æ–≥–∏–¥ API

## ‚ú® –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è —Ä—É—á–∫–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –∞—É–¥–∏–æ–≥–∏–¥–∞ –º–∞—Ä—à—Ä—É—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ MP3.

---

## üéØ –ù–æ–≤—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç

```
GET /api/routes/:route_id/audio
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** MP3 —Ñ–∞–π–ª —Å–æ –≤—Å–µ–º–∏ —Ç–æ—á–∫–∞–º–∏ –º–∞—Ä—à—Ä—É—Ç–∞, –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–º–∏ –≤ –æ–¥–∏–Ω –∞—É–¥–∏–æ–≥–∏–¥

**–°—Ç–∞—Ç—É—Å—ã:**
- `200 OK` - –∞—É–¥–∏–æ–≥–∏–¥ –≥–æ—Ç–æ–≤ (MP3 —Ñ–∞–π–ª)
- `206 Partial Content` - —á–∞—Å—Ç—å –∞—É–¥–∏–æ –µ—â–µ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è (JSON)
- `404 Not Found` - –∞—É–¥–∏–æ –µ—â–µ –Ω–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ (JSON)

---

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### Backend (2 —Ñ–∞–π–ª–∞)

1. **`backend/internal/api/routes.go`**
   - –î–æ–±–∞–≤–ª–µ–Ω —Ä–æ—É—Ç: `routes.GET("/:route_id/audio", routeHandler.GetRouteAudio)`

2. **`backend/internal/api/route_handler.go`**
   - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `mergeAudioFiles()` (—É–±—Ä–∞–Ω –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π import –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–∏)
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã: `io`, `os`

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (5 —Ñ–∞–π–ª–æ–≤)

3. **`README.md`**
   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ API endpoints
   - –î–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ `AUDIO_GUIDE_API.md`

4. **`backend/README.md`**
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏

5. **`AUDIO_GUIDE_API.md`** ‚≠ê –ù–û–í–´–ô
   - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –∞—É–¥–∏–æ–≥–∏–¥–∞
   - –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (JavaScript, Python, Swift)
   - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
   - Troubleshooting

6. **`CHANGELOG_AUDIO_GUIDE.md`** ‚≠ê –ù–û–í–´–ô
   - –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
   - –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
   - Roadmap —É–ª—É—á—à–µ–Ω–∏–π

7. **`QUICK_START_AUDIO.md`** ‚≠ê –ù–û–í–´–ô
   - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∑–∞ 3 –º–∏–Ω—É—Ç—ã
   - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - Troubleshooting

### –¢–µ—Å—Ç—ã (2 —Ñ–∞–π–ª–∞)

8. **`test_route.sh`**
   - –î–æ–±–∞–≤–ª–µ–Ω Step 7: —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ –∞—É–¥–∏–æ–≥–∏–¥–∞
   - –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ –∫–æ–Ω—Ü–µ

9. **`test_audio_guide.sh`** ‚≠ê –ù–û–í–´–ô
   - –°–∫—Ä–∏–ø—Ç –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –∞—É–¥–∏–æ–≥–∏–¥–∞
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ (200/206/404)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ macOS

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–ù–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤:** 4
- **–ò–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:** 5
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–æ:** ~50
- **–°—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** ~800
- **–ù–æ–≤—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤:** 1

---

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

| –î–æ | –ü–æ—Å–ª–µ |
|----|-------|
| N –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è N —Ç–æ—á–µ–∫ | 1 –∑–∞–ø—Ä–æ—Å –¥–ª—è –≤—Å–µ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞ |
| –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ | –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ |
| –°–ª–æ–∂–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è |
| –ë–æ–ª—å—à–µ —Ç—Ä–∞—Ñ–∏–∫–∞ | –ú–µ–Ω—å—à–µ —Ç—Ä–∞—Ñ–∏–∫–∞ |

---

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ü—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–±

```bash
curl http://localhost:8080/api/routes/<route_id>/audio -o guide.mp3
afplay guide.mp3
```

### –° —Ç–µ—Å—Ç–æ–≤—ã–º —Å–∫—Ä–∏–ø—Ç–æ–º

```bash
./test_audio_guide.sh <route_id>
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

1. **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:** [QUICK_START_AUDIO.md](QUICK_START_AUDIO.md)
2. **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [AUDIO_GUIDE_API.md](AUDIO_GUIDE_API.md)
3. **Changelog:** [CHANGELOG_AUDIO_GUIDE.md](CHANGELOG_AUDIO_GUIDE.md)
4. **Backend README:** [backend/README.md](backend/README.md)

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ

```bash
# –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –º–∞—Ä—à—Ä—É—Ç–∞
./test_route.sh

# –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
./test_audio_guide.sh <route_id>
```

### –†—É—á–Ω–æ–µ

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç
curl -X POST http://localhost:8080/api/routes/generate \
  -H "Content-Type: application/json" \
  -d '{"start_point": {"lat": 55.7558, "lon": 37.6173}, "duration_minutes": 60, "epochs": ["soviet"], "interests": ["architecture"]}'

# 2. –°–∫–∞—á–∞—Ç—å –∞—É–¥–∏–æ–≥–∏–¥
curl http://localhost:8080/api/routes/<route_id>/audio -o guide.mp3

# 3. –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
afplay guide.mp3
```

---

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ê–ª–≥–æ—Ä–∏—Ç–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è

```go
func mergeAudioFiles(files []string, routeID string) (string, error) {
    // 1. –°–æ–∑–¥–∞—Ç—å –≤—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª
    outFile := "./audio/route_<id>_full.mp3"
    
    // 2. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã
    for each file in files {
        io.Copy(outFile, file)
    }
    
    // 3. –í–µ—Ä–Ω—É—Ç—å –ø—É—Ç—å
    return outFile
}
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤

```go
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –≤—Å–µ—Ö –∞—É–¥–∏–æ—Ñ–∞–π–ª–æ–≤
for each waypoint {
    if audio_ready {
        audioFiles.append(path)
    } else {
        notReady.append(name)
    }
}

// –í–µ—Ä–Ω—É—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—Ç–∞—Ç—É—Å
if len(audioFiles) == 0 { return 404 }
if len(notReady) > 0 { return 206 }
return 200 + merged_file
```

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. –ü—Ä–æ—Å—Ç–∞—è –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è MP3 (–±–µ–∑ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –≥—Ä–æ–º–∫–æ—Å—Ç–∏)
2. –ù–µ—Ç –ø–∞—É–∑ –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏
3. –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –Ω–µ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è
4. –¢–æ–ª—å–∫–æ —Ñ–æ—Ä–º–∞—Ç MP3

---

## üéØ –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–∞—É–∑ –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏
- Content-Length header

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–æ–º–∫–æ—Å—Ç–∏ (ffmpeg)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥—Ä—É–≥–∏—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤
- Streaming
- –§–æ–Ω–æ–≤–∞—è –º—É–∑—ã–∫–∞

---

## ‚ú® –ò—Ç–æ–≥

**–î–æ–±–∞–≤–ª–µ–Ω–∞ —É–¥–æ–±–Ω–∞—è —Ä—É—á–∫–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ –∞—É–¥–∏–æ–≥–∏–¥–∞ –º–∞—Ä—à—Ä—É—Ç–∞ –æ–¥–Ω–∏–º MP3 —Ñ–∞–π–ª–æ–º.**

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```bash
GET /api/routes/:route_id/audio ‚Üí route_guide.mp3
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ N
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ
- ‚úÖ –£–¥–æ–±—Å—Ç–≤–æ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã

### –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üöÄ

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤:
1. **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:** [QUICK_START_AUDIO.md](QUICK_START_AUDIO.md)
2. **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [AUDIO_GUIDE_API.md](AUDIO_GUIDE_API.md)
3. **Troubleshooting:** –°–º. —Ä–∞–∑–¥–µ–ª –≤ [AUDIO_GUIDE_API.md](AUDIO_GUIDE_API.md#troubleshooting)

---

<div align="center">
  <b>üéâ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!</b>
</div>
