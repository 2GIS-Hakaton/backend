# ðŸŽ§ Ð£Ð¼Ð½Ñ‹Ð¹ ÐÑƒÐ´Ð¸Ð¾Ð³Ð¸Ð´ - ÐŸÐ¾Ð»Ð½Ð°Ñ Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ

## ðŸ“‹ Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð°Ð½Ð¸Ðµ

1. [ÐžÐ±Ñ‰Ð°Ñ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°](#Ð¾Ð±Ñ‰Ð°Ñ-Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°)
2. [Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÐºÐ¾Ð´Ð°](#ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð°-ÐºÐ¾Ð´Ð°)
3. [ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½Ð¾Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð²](#Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ð¾Ðµ-Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ-ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð²)
4. [ÐŸÐ¾Ñ‚Ð¾Ðº Ð´Ð°Ð½Ð½Ñ‹Ñ…](#Ð¿Ð¾Ñ‚Ð¾Ðº-Ð´Ð°Ð½Ð½Ñ‹Ñ…)
5. [API Endpoints](#api-endpoints)
6. [Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…](#Ð±Ð°Ð·Ð°-Ð´Ð°Ð½Ð½Ñ‹Ñ…)
7. [ÐšÐ°Ðº Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ](#ÐºÐ°Ðº-Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ)
8. [ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ](#Ð¿Ñ€Ð¸Ð¼ÐµÑ€Ñ‹-Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ)
9. [Troubleshooting](#troubleshooting)

---

## ðŸ— ÐžÐ±Ñ‰Ð°Ñ ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ÐšÐ›Ð˜Ð•ÐÐ¢ (Frontend/API)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚ HTTP Requests
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     GIN WEB SERVER (:8080)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              API HANDLERS (route_handler.go)              â”‚ â”‚
â”‚  â”‚  - GenerateRoute()  - GetRoute()  - GetPOIs()             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                â”‚                â”‚
       â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POI Service  â”‚ â”‚  GIS Service â”‚ â”‚Content Serviceâ”‚
â”‚              â”‚ â”‚              â”‚ â”‚               â”‚
â”‚ - FindNearby â”‚ â”‚ - FindPlaces â”‚ â”‚ - GenerateTextâ”‚
â”‚ - GetByID    â”‚ â”‚ - BuildRoute â”‚ â”‚ - YandexGPT   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                  â”‚
       â”‚                â”‚                  â”‚
       â–¼                â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL  â”‚ â”‚  2GIS API    â”‚ â”‚ Yandex APIs  â”‚
â”‚   Database   â”‚ â”‚              â”‚ â”‚  - GPT       â”‚
â”‚              â”‚ â”‚              â”‚ â”‚  - TTS       â”‚
â”‚  - pois      â”‚ â”‚              â”‚ â”‚  - Search    â”‚
â”‚  - routes    â”‚ â”‚              â”‚ â”‚              â”‚
â”‚  - waypoints â”‚ â”‚              â”‚ â”‚              â”‚
â”‚  - contents  â”‚ â”‚              â”‚ â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° ÐšÐ¾Ð´Ð°

```
backend/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go              # ðŸš€ Ð¢Ð¾Ñ‡ÐºÐ° Ð²Ñ…Ð¾Ð´Ð° Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
â”‚
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ api/                     # ðŸŒ HTTP Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸
â”‚   â”‚   â”œâ”€â”€ routes.go            # Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ Ð²ÑÐµÑ… endpoints
â”‚   â”‚   â””â”€â”€ route_handler.go    # Ð›Ð¾Ð³Ð¸ÐºÐ° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                  # ðŸ“Š ÐœÐ¾Ð´ÐµÐ»Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…
â”‚   â”‚   â””â”€â”€ models.go            # POI, Route, Waypoint, Content
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                # ðŸ”§ Ð‘Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÐ°
â”‚   â”‚   â”œâ”€â”€ poi_service.go       # Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð¼ÐµÑÑ‚Ð°Ð¼Ð¸ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐ°
â”‚   â”‚   â”œâ”€â”€ gis_service.go       # Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ 2GIS
â”‚   â”‚   â”œâ”€â”€ content_service.go   # Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ñ‚ÐµÐºÑÑ‚Ð° (YandexGPT)
â”‚   â”‚   â””â”€â”€ tts_service.go       # Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð°ÑƒÐ´Ð¸Ð¾ (Yandex TTS)
â”‚   â”‚
â”‚   â””â”€â”€ database/                # ðŸ’¾ Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð‘Ð”
â”‚       â””â”€â”€ postgres.go          # ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð¸ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸
â”‚
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config.yaml              # âš™ï¸ ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ
â”‚
â”œâ”€â”€ audio/                       # ðŸ”Š Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð°ÑƒÐ´Ð¸Ð¾Ñ„Ð°Ð¹Ð»Ñ‹
â”œâ”€â”€ keys/                        # ðŸ”‘ API ÐºÐ»ÑŽÑ‡Ð¸
â”‚   â””â”€â”€ 2gis.key
â”‚
â”œâ”€â”€ go.mod                       # ðŸ“¦ Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Go
â””â”€â”€ .env                         # ðŸ” ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
```

---

## ðŸ” ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½Ð¾Ðµ ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ ÐšÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð²

### 1. `cmd/server/main.go` - Ð¢Ð¾Ñ‡ÐºÐ° Ð²Ñ…Ð¾Ð´Ð°

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°ÐµÑ‚:**
- Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÑ‚ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð¸Ð· `.env`
- ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ÑÑ Ðº PostgreSQL
- Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð‘Ð”
- Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ GIN Ð²ÐµÐ±-ÑÐµÑ€Ð²ÐµÑ€ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 8080
- Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€ÑƒÐµÑ‚ Ð²ÑÐµ API endpoints

**ÐšÐ¾Ð´:**
```go
func main() {
    // 1. Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° .env
    godotenv.Load()
    
    // 2. ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Ð‘Ð”
    db, err := database.Connect()
    
    // 3. ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ (ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ‚Ð°Ð±Ð»Ð¸Ñ†)
    database.Migrate(db)
    
    // 4. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ñ€Ð¾ÑƒÑ‚ÐµÑ€Ð°
    router := gin.Default()
    
    // 5. Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ endpoints
    api.RegisterRoutes(router, db)
    
    // 6. Ð—Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²ÐµÑ€Ð°
    router.Run(":8080")
}
```

**ÐŸÐ¾Ñ‚Ð¾Ðº Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ:**
1. Ð§Ð¸Ñ‚Ð°ÐµÑ‚ `DATABASE_URL` Ð¸Ð· env
2. Ð¡Ð¾Ð·Ð´Ð°ÐµÑ‚ connection pool Ðº PostgreSQL
3. Ð¡Ð¾Ð·Ð´Ð°ÐµÑ‚ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹ ÐµÑÐ»Ð¸ Ð¸Ñ… Ð½ÐµÑ‚
4. Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð¸Ñ€ÑƒÐµÑ‚ Ð²ÑÐµ ÑÐµÑ€Ð²Ð¸ÑÑ‹
5. Ð¡Ð»ÑƒÑˆÐ°ÐµÑ‚ HTTP Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð½Ð° `:8080`

---

### 2. `internal/models/models.go` - ÐœÐ¾Ð´ÐµÐ»Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…

#### **POI (Point of Interest) - ÐœÐµÑÑ‚Ð¾ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐ°**

```go
type POI struct {
    ID          uuid.UUID      // Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ID
    Name        string         // ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ (Ð’Ð”ÐÐ¥, ÐšÑ€ÐµÐ¼Ð»ÑŒ)
    Description string         // ÐšÑ€Ð°Ñ‚ÐºÐ¾Ðµ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸Ðµ
    Latitude    float64        // Ð¨Ð¸Ñ€Ð¾Ñ‚Ð° (55.7558)
    Longitude   float64        // Ð”Ð¾Ð»Ð³Ð¾Ñ‚Ð° (37.6173)
    Epoch       string         // Ð­Ð¿Ð¾Ñ…Ð°: medieval, imperial, soviet, modern
    Category    string         // ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ñ: architecture, history, art
    Importance  int            // Ð’Ð°Ð¶Ð½Ð¾ÑÑ‚ÑŒ 1-10
    YearBuilt   int            // Ð“Ð¾Ð´ Ð¿Ð¾ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
    Architect   string         // ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚Ð¾Ñ€
    Style       string         // Ð¡Ñ‚Ð¸Ð»ÑŒ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñ‹
    Photos      pq.StringArray // ÐœÐ°ÑÑÐ¸Ð² URL Ñ„Ð¾Ñ‚Ð¾Ð³Ñ€Ð°Ñ„Ð¸Ð¹
    CreatedAt   time.Time      // ÐšÐ¾Ð³Ð´Ð° ÑÐ¾Ð·Ð´Ð°Ð½
    UpdatedAt   time.Time      // ÐšÐ¾Ð³Ð´Ð° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½
}
```

**Ð“Ð´Ðµ Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑÑ:** Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° `pois` Ð² PostgreSQL  
**ÐšÐ°Ðº ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ÑÑ:** Ð§ÐµÑ€ÐµÐ· SQL ÑÐºÑ€Ð¸Ð¿Ñ‚ `scripts/import_sample_pois.py`  
**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```json
{
  "id": "179fd8c2-37cb-4c7d-8d7b-7fe0fd564d7f",
  "name": "Ð’Ð”ÐÐ¥",
  "latitude": 55.8304,
  "longitude": 37.6325,
  "epoch": "soviet",
  "category": "architecture",
  "importance": 10
}
```

---

#### **Route - ÐœÐ°Ñ€ÑˆÑ€ÑƒÑ‚**

```go
type Route struct {
    ID                uuid.UUID      // ID Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð°
    Name              string         // "Ð¡Ð¾Ð²ÐµÑ‚ÑÐºÐ°Ñ ÐœÐ¾ÑÐºÐ²Ð°: ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°"
    Description       string         // ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð°
    TotalDistance     float64        // ÐžÐ±Ñ‰Ð°Ñ Ð´Ð¸ÑÑ‚Ð°Ð½Ñ†Ð¸Ñ Ð² Ð¼ÐµÑ‚Ñ€Ð°Ñ…
    EstimatedDuration int            // Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð² Ð¼Ð¸Ð½ÑƒÑ‚Ð°Ñ…
    Waypoints         []Waypoint     // Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ‚Ð¾Ñ‡ÐµÐº Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð°
    Epochs            pq.StringArray // ["soviet", "medieval"]
    Categories        pq.StringArray // ["architecture", "history"]
    CreatedAt         time.Time      // ÐšÐ¾Ð³Ð´Ð° ÑÐ¾Ð·Ð´Ð°Ð½
}
```

**Ð“Ð´Ðµ Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑÑ:** Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° `routes`  
**ÐšÐ°Ðº ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ÑÑ:** Ð§ÐµÑ€ÐµÐ· POST `/api/routes/generate`  
**Ð¡Ð²ÑÐ·Ð¸:** Ð˜Ð¼ÐµÐµÑ‚ Ð¼Ð½Ð¾Ð³Ð¾ Waypoints (Ð¾Ð´Ð½Ð° Ñ‚Ð¾Ñ‡ÐºÐ° Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð° = Ð¾Ð´Ð¸Ð½ waypoint)

---

#### **Waypoint - Ð¢Ð¾Ñ‡ÐºÐ° Ð½Ð° Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ðµ**

```go
type Waypoint struct {
    ID        uuid.UUID  // ID waypoint
    RouteID   uuid.UUID  // Ðš ÐºÐ°ÐºÐ¾Ð¼Ñƒ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ñƒ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÑÑ
    POIID     uuid.UUID  // ID Ð¼ÐµÑÑ‚Ð° Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐ°
    POI       POI        // ÐŸÐ¾Ð»Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¼ÐµÑÑ‚Ð°
    Order     int        // ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº (1, 2, 3...)
    Content   *Content   // ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ (Ñ‚ÐµÐºÑÑ‚ + Ð°ÑƒÐ´Ð¸Ð¾)
    CreatedAt time.Time
}
```

**Ð“Ð´Ðµ Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑÑ:** Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° `waypoints`  
**Ð¡Ð²ÑÐ·Ð¸:**
- `RouteID` â†’ `routes.id` (Ð¿Ñ€Ð¸Ð½Ð°Ð´Ð»ÐµÐ¶Ð¸Ñ‚ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ñƒ)
- `POIID` â†’ `pois.id` (ÑÑÑ‹Ð»Ð°ÐµÑ‚ÑÑ Ð½Ð° Ð¼ÐµÑÑ‚Ð¾)
- `Content` â†’ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾

**ÐŸÑ€Ð¸Ð¼ÐµÑ€ ÑÐ²ÑÐ·Ð¸:**
```
Route "Ð¡Ð¾Ð²ÐµÑ‚ÑÐºÐ°Ñ ÐœÐ¾ÑÐºÐ²Ð°"
  â”œâ”€ Waypoint #1 â†’ POI "Ð’Ð”ÐÐ¥" â†’ Content (Ñ‚ÐµÐºÑÑ‚ + audio.mp3)
  â”œâ”€ Waypoint #2 â†’ POI "ÐœÐ“Ð£" â†’ Content (Ñ‚ÐµÐºÑÑ‚ + audio.mp3)
  â””â”€ Waypoint #3 â†’ POI "ÐžÑÑ‚Ð°Ð½ÐºÐ¸Ð½ÑÐºÐ°Ñ Ð±Ð°ÑˆÐ½Ñ" â†’ Content (Ñ‚ÐµÐºÑÑ‚ + audio.mp3)
```

---

#### **Content - ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ Ð´Ð»Ñ Ñ‚Ð¾Ñ‡ÐºÐ¸**

```go
type Content struct {
    ID         uuid.UUID      // ID ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð°
    WaypointID uuid.UUID      // Ðš ÐºÐ°ÐºÐ¾Ð¼Ñƒ waypoint Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÑÑ
    Text       string         // Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ñ‚ÐµÐºÑÑ‚ (300-400 ÑÐ»Ð¾Ð²)
    AudioPath  string         // ÐŸÑƒÑ‚ÑŒ Ðº MP3 Ñ„Ð°Ð¹Ð»Ñƒ
    AudioURL   string         // URL Ð´Ð»Ñ ÑÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ñ (/api/audio/uuid)
    Duration   int            // Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð°ÑƒÐ´Ð¸Ð¾ Ð² ÑÐµÐºÑƒÐ½Ð´Ð°Ñ…
    Photos     pq.StringArray // Ð¤Ð¾Ñ‚Ð¾Ð³Ñ€Ð°Ñ„Ð¸Ð¸
    Generated  bool           // true ÐµÑÐ»Ð¸ ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾
    CreatedAt  time.Time
}
```

**Ð“Ð´Ðµ Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑÑ:** Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° `contents`  
**ÐšÐ°Ðº ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ÑÑ:** ÐÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾ Ð¿Ð¾ÑÐ»Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ waypoint  
**ÐŸÑ€Ð¾Ñ†ÐµÑÑ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸:**
1. YandexGPT Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ Ñ‚ÐµÐºÑÑ‚ (2-3 Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ)
2. Yandex TTS ÑÐ¾Ð·Ð´Ð°ÐµÑ‚ MP3 Ð¸Ð· Ñ‚ÐµÐºÑÑ‚Ð°
3. Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ Ð² `./audio/waypoint-id.mp3`
4. Ð—Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÑ‚ Ð² Ð‘Ð”

---

### 3. `internal/services/` - Ð¡ÐµÑ€Ð²Ð¸ÑÑ‹ (Ð‘Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÐ°)

#### **POIService** - Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð¼ÐµÑÑ‚Ð°Ð¼Ð¸ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐ°

**Ð¤Ð°Ð¹Ð»:** `poi_service.go`

**ÐœÐµÑ‚Ð¾Ð´Ñ‹:**

##### `FindNearby()` - ÐŸÐ¾Ð¸ÑÐº Ð¼ÐµÑÑ‚ Ñ€ÑÐ´Ð¾Ð¼ Ñ Ñ‚Ð¾Ñ‡ÐºÐ¾Ð¹

```go
func (s *POIService) FindNearby(
    lat, lon float64,        // ÐšÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ñ‹ Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸
    radiusMeters float64,    // Ð Ð°Ð´Ð¸ÑƒÑ Ð¿Ð¾Ð¸ÑÐºÐ° Ð² Ð¼ÐµÑ‚Ñ€Ð°Ñ…
    epochs []string,         // Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ ÑÐ¿Ð¾Ñ…Ð°Ð¼
    categories []string,     // Ð¤Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸ÑÐ¼
) ([]models.POI, error)
```

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°ÐµÑ‚:**
1. Ð—Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÐµÑ‚ Ð²ÑÐµ POI Ð¸Ð· Ð‘Ð” Ñ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ð¼Ð¸ Ð¿Ð¾ ÑÐ¿Ð¾Ñ…Ðµ Ð¸ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸
2. Ð’Ñ‹Ñ‡Ð¸ÑÐ»ÑÐµÑ‚ Ñ€Ð°ÑÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð¾Ñ‚ Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð´Ð¾ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ POI (Ñ„Ð¾Ñ€Ð¼ÑƒÐ»Ð° Haversine)
3. ÐžÑ‚Ð±Ð¸Ñ€Ð°ÐµÑ‚ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð² Ñ€Ð°Ð´Ð¸ÑƒÑÐµ
4. Ð¡Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ Ð¿Ð¾ Ð²Ð°Ð¶Ð½Ð¾ÑÑ‚Ð¸ (importance)
5. Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¾Ñ‚ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº

**Ð¤Ð¾Ñ€Ð¼ÑƒÐ»Ð° Ñ€Ð°ÑÑÑ‚Ð¾ÑÐ½Ð¸Ñ (Haversine):**
```go
func calculateDistance(lat1, lon1, lat2, lon2 float64) float64 {
    const earthRadius = 6371000.0 // Ð¼ÐµÑ‚Ñ€Ñ‹
    
    // ÐŸÐµÑ€ÐµÐ²Ð¾Ð´Ð¸Ð¼ Ð² Ñ€Ð°Ð´Ð¸Ð°Ð½Ñ‹
    lat1Rad := lat1 * math.Pi / 180
    lat2Rad := lat2 * math.Pi / 180
    deltaLat := (lat2 - lat1) * math.Pi / 180
    deltaLon := (lon2 - lon1) * math.Pi / 180
    
    // Ð¤Ð¾Ñ€Ð¼ÑƒÐ»Ð° Haversine
    a := sinÂ²(Î”lat/2) + cos(lat1) Ã— cos(lat2) Ã— sinÂ²(Î”lon/2)
    c := 2 Ã— atan2(âˆša, âˆš(1âˆ’a))
    
    return earthRadius Ã— c  // Ñ€Ð°ÑÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð² Ð¼ÐµÑ‚Ñ€Ð°Ñ…
}
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```go
// ÐŸÐ¾Ð¸ÑÐº ÑÐ¾Ð²ÐµÑ‚ÑÐºÐ¸Ñ… Ð¿Ð°Ð¼ÑÑ‚Ð½Ð¸ÐºÐ¾Ð² Ð² Ñ€Ð°Ð´Ð¸ÑƒÑÐµ 5ÐºÐ¼ Ð¾Ñ‚ ÐšÑ€Ð°ÑÐ½Ð¾Ð¹ Ð¿Ð»Ð¾Ñ‰Ð°Ð´Ð¸
pois, _ := poiService.FindNearby(
    55.7539, 37.6208,     // ÐšÑ€Ð°ÑÐ½Ð°Ñ Ð¿Ð»Ð¾Ñ‰Ð°Ð´ÑŒ
    5000,                  // 5 ÐºÐ¼
    []string{"soviet"},    // Ð¡Ð¾Ð²ÐµÑ‚ÑÐºÐ°Ñ ÑÐ¿Ð¾Ñ…Ð°
    []string{"architecture"}, // ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°
)
// Ð’ÐµÑ€Ð½ÐµÑ‚: [Ð’Ð”ÐÐ¥, ÐœÐ“Ð£, ÐžÑÑ‚Ð°Ð½ÐºÐ¸Ð½Ð¾, ...]
```

---

#### **GISService** - Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ 2GIS API

**Ð¤Ð°Ð¹Ð»:** `gis_service.go`

**ÐœÐµÑ‚Ð¾Ð´Ñ‹:**

##### `FindPlacesNearby()` - ÐŸÐ¾Ð¸ÑÐº Ð¼ÐµÑÑ‚ Ñ‡ÐµÑ€ÐµÐ· 2GIS

```go
func (s *GISService) FindPlacesNearby(
    lat, lon, radius float64,
    query string,           // ÐŸÐ¾Ð¸ÑÐºÐ¾Ð²Ñ‹Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ
) ([]Place, error)
```

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°ÐµÑ‚:**
1. Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÑ‚ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ðº 2GIS Catalog API
2. Ð˜Ñ‰ÐµÑ‚ Ð¼ÐµÑÑ‚Ð° Ð¿Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÑƒ Ð² Ñ€Ð°Ð´Ð¸ÑƒÑÐµ
3. Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ ÑÐ¿Ð¸ÑÐ¾Ðº Ð¼ÐµÑÑ‚ Ñ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ð°Ð¼Ð¸

**API Ð·Ð°Ð¿Ñ€Ð¾Ñ:**
```
GET https://catalog.api.2gis.com/3.0/items
  ?key={API_KEY}
  &point={lon},{lat}
  &radius={radius}
  &q={query}
```

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```go
places, _ := gisService.FindPlacesNearby(
    55.7558, 37.6173,
    2000,
    "Ð¼ÑƒÐ·ÐµÐ¹",
)
// Ð’ÐµÑ€Ð½ÐµÑ‚ Ð¼ÐµÑÑ‚Ð° Ð¸Ð· 2GIS API
```

##### `BuildRoute()` - ÐŸÐ¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ðµ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð°

```go
func (s *GISService) BuildRoute(
    points []RoutePoint,    // Ð¡Ð¿Ð¸ÑÐ¾Ðº Ñ‚Ð¾Ñ‡ÐµÐº
    routeType string,       // "pedestrian" Ð¸Ð»Ð¸ "car"
) (*RouteResult, error)
```

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°ÐµÑ‚:**
1. ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð² 2GIS Routing API
2. ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð¾Ð¿Ñ‚Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚
3. Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ñ€Ð°ÑÑÑ‚Ð¾ÑÐ½Ð¸Ðµ, Ð²Ñ€ÐµÐ¼Ñ, Ð³ÐµÐ¾Ð¼ÐµÑ‚Ñ€Ð¸ÑŽ

**API Ð·Ð°Ð¿Ñ€Ð¾Ñ:**
```
GET https://catalog.api.2gis.com/routing/7.0.0/global
  ?key={API_KEY}
  &type=pedestrian
  &points={lon1},{lat1};{lon2},{lat2};...
```

**ÐžÑ‚Ð²ÐµÑ‚:**
```json
{
  "total_distance": 4500,  // Ð¼ÐµÑ‚Ñ€Ñ‹
  "total_duration": 3600,  // ÑÐµÐºÑƒÐ½Ð´Ñ‹
  "geometry": [[37.6173, 55.7558], [37.6325, 55.8304], ...]
}
```

---

#### **ContentService** - Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð°

**Ð¤Ð°Ð¹Ð»:** `content_service.go`

##### `GenerateDescription()` - Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ñ‚ÐµÐºÑÑ‚Ð°

```go
func (s *ContentService) GenerateDescription(
    poi models.POI,
) (string, error)
```

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°ÐµÑ‚:**

**Ð¨Ð°Ð³ 1:** ÐŸÐ¾Ð¸ÑÐº Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
```go
if s.searchUser != "" {
    // Ð˜Ñ‰ÐµÐ¼ Ñ‡ÐµÑ€ÐµÐ· Yandex Search API
    additionalInfo := searchForPOI(poi)
}
```

**Ð¨Ð°Ð³ 2:** Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ñ€Ð¾Ð¼Ð¿Ñ‚Ð° Ð´Ð»Ñ YandexGPT
```go
prompt := fmt.Sprintf(`
Ð¡Ð¾Ð·Ð´Ð°Ð¹ ÑƒÐ²Ð»ÐµÐºÐ°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ñ€Ð°ÑÑÐºÐ°Ð· Ð´Ð»Ñ Ð°ÑƒÐ´Ð¸Ð¾Ð³Ð¸Ð´Ð° Ð¾ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼ Ð¼ÐµÑÑ‚Ðµ:

ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ: %s
ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ: %s
Ð­Ð¿Ð¾Ñ…Ð°: %s
Ð“Ð¾Ð´ Ð¿Ð¾ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸: %d
ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚Ð¾Ñ€: %s

Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ:
- Ð”Ð»Ð¸Ð½Ð°: 2-3 Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹ Ñ‡Ñ‚ÐµÐ½Ð¸Ñ (300-400 ÑÐ»Ð¾Ð²)
- Ð¡Ñ‚Ð¸Ð»ÑŒ: Ð¶Ð¸Ð²Ð¾Ð¹, ÑƒÐ²Ð»ÐµÐºÐ°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹
- Ð’ÐºÐ»ÑŽÑ‡Ð¸ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐ½Ñ‹Ðµ Ñ„Ð°ÐºÑ‚Ñ‹
- ÐžÐ±Ñ€Ð°Ñ‰Ð°Ð¹ÑÑ Ð½Ð° "Ð²Ñ‹"
`, poi.Name, poi.Description, poi.Epoch, poi.YearBuilt, poi.Architect)
```

**Ð¨Ð°Ð³ 3:** Ð—Ð°Ð¿Ñ€Ð¾Ñ Ðº YandexGPT
```json
POST https://llm.api.cloud.yandex.net/foundationModels/v1/completion
{
  "modelUri": "gpt://folder_id/yandexgpt/latest",
  "messages": [
    {"role": "system", "text": "Ð¢Ñ‹ Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÑÐºÑÐºÑƒÑ€ÑÐ¾Ð²Ð¾Ð´..."},
    {"role": "user", "text": "{prompt}"}
  ],
  "completionOptions": {
    "temperature": 0.7,
    "maxTokens": "1000"
  }
}
```

**Ð¨Ð°Ð³ 4:** ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð²ÐµÑ‚Ð°
```json
{
  "result": {
    "alternatives": [{
      "message": {
        "text": "ÐŸÐµÑ€ÐµÐ´ Ð²Ð°Ð¼Ð¸ Ð·Ð½Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ð°Ñ Ð’Ð”ÐÐ¥ - Ð³Ñ€Ð°Ð½Ð´Ð¸Ð¾Ð·Ð½Ñ‹Ð¹ Ð²Ñ‹ÑÑ‚Ð°Ð²Ð¾Ñ‡Ð½Ñ‹Ð¹ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ..."
      }
    }]
  }
}
```

**Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚:** Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ñ‚ÐµÐºÑÑ‚ (300-400 ÑÐ»Ð¾Ð²)

---

#### **TTSService** - Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð°ÑƒÐ´Ð¸Ð¾

**Ð¤Ð°Ð¹Ð»:** `tts_service.go`

##### `GenerateAudio()` - Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ MP3

```go
func (s *TTSService) GenerateAudio(
    text string,      // Ð¢ÐµÐºÑÑ‚ Ð´Ð»Ñ Ð¾Ð·Ð²ÑƒÑ‡Ð¸Ð²Ð°Ð½Ð¸Ñ
    filename string,  // waypoint-id
) (audioPath string, duration int, error)
```

**Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°ÐµÑ‚:**

**Ð¨Ð°Ð³ 1:** Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° Ðº Yandex SpeechKit
```
POST https://tts.api.cloud.yandex.net/speech/v1/tts:synthesize
  ?text={text}
  &lang=ru-RU
  &voice=alena
  &speed=1.0
  &format=mp3
  &folderId={folder_id}

Headers:
  Authorization: Api-Key {api_key}
```

**Ð¨Ð°Ð³ 2:** ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð°ÑƒÐ´Ð¸Ð¾ (Ð±Ð¸Ð½Ð°Ñ€Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ MP3)

**Ð¨Ð°Ð³ 3:** Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð² Ñ„Ð°Ð¹Ð»
```go
audioPath := "./audio/waypoint-uuid.mp3"
file.Write(audioData)
```

**Ð¨Ð°Ð³ 4:** Ð Ð°ÑÑ‡ÐµÑ‚ Ð´Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸
```go
// ÐŸÑ€Ð¸Ð¼ÐµÑ€Ð½Ð¾ 150 ÑÐ»Ð¾Ð² Ð² Ð¼Ð¸Ð½ÑƒÑ‚Ñƒ
words := len(text) / 5
durationSeconds := (words * 60) / 150
```

**Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚:**
- `audioPath`: "./audio/123e4567-e89b-12d3-a456-426614174000.mp3"
- `duration`: 180 (ÑÐµÐºÑƒÐ½Ð´)

**Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ð³Ð¾Ð»Ð¾ÑÐ°:**
- `alena` - Ð¼ÑÐ³ÐºÐ¸Ð¹ Ð¶ÐµÐ½ÑÐºÐ¸Ð¹ (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ)
- `filipp` - Ð½ÐµÐ¹Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¼ÑƒÐ¶ÑÐºÐ¾Ð¹
- `jane` - ÑÐ¼Ð¾Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¶ÐµÐ½ÑÐºÐ¸Ð¹
- `ermil` - ÑÐ¼Ð¾Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¼ÑƒÐ¶ÑÐºÐ¾Ð¹

---

### 4. `internal/api/route_handler.go` - HTTP Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸

#### `GenerateRoute()` - Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð°

**Endpoint:** `POST /api/routes/generate`

**Ð’Ñ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ:**
```json
{
  "start_point": {
    "lat": 55.7558,
    "lon": 37.6173
  },
  "duration_minutes": 60,
  "epochs": ["soviet", "medieval"],
  "interests": ["architecture", "history"],
  "max_waypoints": 5
}
```

**ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°                            â”‚
â”‚    - ÐŸÐ°Ñ€ÑÐ¸Ð½Ð³ JSON                               â”‚
â”‚    - Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¾Ð²                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Ð Ð°ÑÑ‡ÐµÑ‚ Ñ€Ð°Ð´Ð¸ÑƒÑÐ° Ð¿Ð¾Ð¸ÑÐºÐ°                        â”‚
â”‚    radius = duration_minutes Ã— 83 Ð¼/Ð¼Ð¸Ð½         â”‚
â”‚    (ÑÑ€ÐµÐ´Ð½ÑÑ ÑÐºÐ¾Ñ€Ð¾ÑÑ‚ÑŒ Ð¿ÐµÑˆÐµÑ…Ð¾Ð´Ð°)                  â”‚
â”‚    ÐŸÑ€Ð¸Ð¼ÐµÑ€: 60 Ð¼Ð¸Ð½ Ã— 83 = 4980 Ð¼ÐµÑ‚Ñ€Ð¾Ð²           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ÐŸÐ¾Ð¸ÑÐº POI                                    â”‚
â”‚    poiService.FindNearby(                       â”‚
â”‚      lat, lon, radius,                          â”‚
â”‚      epochs, interests                          â”‚
â”‚    )                                            â”‚
â”‚    â†“                                            â”‚
â”‚    Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚: [POI1, POI2, POI3, ...]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð°                          â”‚
â”‚    if len(pois) == 0:                           â”‚
â”‚      return error "No POIs found"               â”‚
â”‚                                                 â”‚
â”‚    if len(pois) > max_waypoints:                â”‚
â”‚      pois = pois[:max_waypoints]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð° Ð² Ð‘Ð”                       â”‚
â”‚    route = Route{                               â”‚
â”‚      Name: "Ð¡Ð¾Ð²ÐµÑ‚ÑÐºÐ°Ñ ÐœÐ¾ÑÐºÐ²Ð°: ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°",     â”‚
â”‚      EstimatedDuration: 60,                     â”‚
â”‚      Epochs: ["soviet"],                        â”‚
â”‚      Categories: ["architecture"]               â”‚
â”‚    }                                            â”‚
â”‚    db.Create(&route)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ waypoints                           â”‚
â”‚    for i, poi := range pois {                   â”‚
â”‚      waypoint = Waypoint{                       â”‚
â”‚        RouteID: route.ID,                       â”‚
â”‚        POIID: poi.ID,                           â”‚
â”‚        Order: i + 1                             â”‚
â”‚      }                                          â”‚
â”‚      waypoints = append(waypoints, waypoint)    â”‚
â”‚    }                                            â”‚
â”‚    db.Create(&waypoints)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Ð—Ð°Ð¿ÑƒÑÐº Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð° (Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾)      â”‚
â”‚    go generateContentForWaypoints(waypoints)    â”‚
â”‚    â†“                                            â”‚
â”‚    Ð’ Ñ„Ð¾Ð½Ðµ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ waypoint:                 â”‚
â”‚    - Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ Ñ‚ÐµÐºÑÑ‚ Ñ‡ÐµÑ€ÐµÐ· YandexGPT           â”‚
â”‚    - Ð¡Ð¾Ð·Ð´Ð°ÐµÑ‚ Ð°ÑƒÐ´Ð¸Ð¾ Ñ‡ÐµÑ€ÐµÐ· Yandex TTS             â”‚
â”‚    - Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÑ‚ Ð² Ð‘Ð”                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¾Ñ‚Ð²ÐµÑ‚Ð°                          â”‚
â”‚    response = {                                 â”‚
â”‚      route_id: "uuid",                          â”‚
â”‚      name: "Ð¡Ð¾Ð²ÐµÑ‚ÑÐºÐ°Ñ ÐœÐ¾ÑÐºÐ²Ð°",                  â”‚
â”‚      waypoints: [...]                           â”‚
â”‚    }                                            â”‚
â”‚    return JSON                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Ð’Ñ‹Ñ…Ð¾Ð´Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ:**
```json
{
  "route_id": "ea7a7092-8fa1-44c2-a656-55f38d4822e3",
  "name": "Ð¡Ð¾Ð²ÐµÑ‚ÑÐºÐ°Ñ ÐœÐ¾ÑÐºÐ²Ð°: ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°",
  "total_distance": 0,
  "estimated_duration": 60,
  "waypoints": [
    {
      "id": "waypoint-uuid-1",
      "name": "Ð’Ð”ÐÐ¥",
      "description": "Ð’Ñ‹ÑÑ‚Ð°Ð²ÐºÐ° Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ð¹...",
      "coordinates": {"lat": 55.8304, "lon": 37.6325},
      "epoch": "soviet",
      "category": "architecture",
      "order": 1,
      "content": null  // Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾
    }
  ]
}
```

---

#### `GetRoute()` - ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð°

**Endpoint:** `GET /api/routes/:route_id`

**ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼:**
1. ÐŸÐ°Ñ€ÑÐ¸Ñ‚ `route_id` Ð¸Ð· URL
2. Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÑ‚ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚ Ð¸Ð· Ð‘Ð” Ñ Preload:
   ```go
   db.Preload("Waypoints.POI").
      Preload("Waypoints.Content").
      First(&route, "id = ?", uid)
   ```
3. Ð¤Ð¾Ñ€Ð¼Ð¸Ñ€ÑƒÐµÑ‚ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ð¾Ñ‚Ð²ÐµÑ‚ Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð¾Ð¼
4. Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ JSON

**ÐžÑ‚Ð²ÐµÑ‚ (Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð¾Ð¼):**
```json
{
  "route_id": "ea7a7092-...",
  "waypoints": [
    {
      "id": "waypoint-1",
      "name": "Ð’Ð”ÐÐ¥",
      "content": {
        "text": "ÐŸÐµÑ€ÐµÐ´ Ð²Ð°Ð¼Ð¸ Ð·Ð½Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ð°Ñ Ð’Ð”ÐÐ¥...",
        "audio_url": "/api/audio/waypoint-1",
        "duration_seconds": 180,
        "photos": ["url1", "url2"]
      }
    }
  ]
}
```

---

## ðŸ”„ ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ ÐŸÐ¾Ñ‚Ð¾Ðº Ð”Ð°Ð½Ð½Ñ‹Ñ…

### Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹: ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚

```
ÐšÐ›Ð˜Ð•ÐÐ¢                 API HANDLER           SERVICES              Ð‘ÐÐ—Ð Ð”ÐÐÐÐ«Ð¥        Ð’ÐÐ•Ð¨ÐÐ˜Ð• API
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚ POST /routes/generate   â”‚                    â”‚                      â”‚                  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚ FindNearby()       â”‚                      â”‚                  â”‚
  â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                  â”‚
  â”‚                         â”‚                    â”‚  SELECT * FROM pois  â”‚                  â”‚
  â”‚                         â”‚                    â”‚  WHERE epoch IN (...)â”‚                  â”‚
  â”‚                         â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
  â”‚                         â”‚                    â”‚   [POI1, POI2, ...]  â”‚                  â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚ [filtered POIs]    â”‚                      â”‚                  â”‚
  â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚                  â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚  INSERT route      â”‚                      â”‚                  â”‚
  â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚  INSERT waypoints  â”‚                      â”‚                  â”‚
  â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚  {route_id, waypoints}  â”‚                    â”‚                      â”‚                  â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚ go generateContent()                      â”‚                  â”‚
  â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                  â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚                    â”‚ GenerateDescription()                   â”‚
  â”‚                         â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                         â”‚                    â”‚                      â”‚   YandexGPT API  â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                         â”‚                    â”‚        {text}        â”‚                  â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚                    â”‚ GenerateAudio()      â”‚                  â”‚
  â”‚                         â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                         â”‚                    â”‚                      â”‚   Yandex TTS     â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                         â”‚                    â”‚      {audio.mp3}     â”‚                  â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚                    â”‚  INSERT content      â”‚                  â”‚
  â”‚                         â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚ GET /routes/{id}        â”‚                    â”‚                      â”‚                  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚  SELECT route      â”‚                      â”‚                  â”‚
  â”‚                         â”‚  WITH waypoints    â”‚                      â”‚                  â”‚
  â”‚                         â”‚  AND content       â”‚                      â”‚                  â”‚
  â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
  â”‚  {route + content}      â”‚   [full data]      â”‚                      â”‚                  â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚ GET /audio/{waypoint}   â”‚                    â”‚                      â”‚                  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚  SELECT content    â”‚                      â”‚                  â”‚
  â”‚                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚
  â”‚                         â”‚                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚
  â”‚  audio.mp3 (binary)     â”‚   {audio_path}     â”‚                      â”‚                  â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                      â”‚                  â”‚
  â”‚                         â”‚  Read file & send  â”‚                      â”‚                  â”‚
```

---

## ðŸ“¡ API Endpoints - ÐŸÐ¾Ð´Ñ€Ð¾Ð±Ð½Ð°Ñ Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ

### 1. Health Check

**Endpoint:** `GET /api/health`

**ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ:** ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð±Ð¾Ñ‚Ð¾ÑÐ¿Ð¾ÑÐ¾Ð±Ð½Ð¾ÑÑ‚Ð¸ ÑÐµÑ€Ð²ÐµÑ€Ð°

**Ð—Ð°Ð¿Ñ€Ð¾Ñ:**
```bash
curl http://localhost:8080/api/health
```

**ÐžÑ‚Ð²ÐµÑ‚:**
```json
{
  "status": "ok",
  "message": "Audioguid API is running"
}
```

---

### 2. Ð¡Ð¿Ð¸ÑÐ¾Ðº Ð¼ÐµÑÑ‚ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐ°

**Endpoint:** `GET /api/pois`

**ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ:** ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð²ÑÐµÑ… POI Ð¸Ð»Ð¸ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ð°Ñ†Ð¸Ñ

**Query Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**
- `epoch` - Ñ„Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ ÑÐ¿Ð¾Ñ…Ðµ (`medieval`, `imperial`, `soviet`, `modern`)
- `category` - Ñ„Ð¸Ð»ÑŒÑ‚Ñ€ Ð¿Ð¾ ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ (`architecture`, `history`, `art`, `culture`, `religion`)

**ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹:**

```bash
# Ð’ÑÐµ POI
curl http://localhost:8080/api/pois

# Ð¡Ð¾Ð²ÐµÑ‚ÑÐºÐ°Ñ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°
curl "http://localhost:8080/api/pois?epoch=soviet&category=architecture"

# Ð¡Ñ€ÐµÐ´Ð½ÐµÐ²ÐµÐºÐ¾Ð²Ð°Ñ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ
curl "http://localhost:8080/api/pois?epoch=medieval&category=history"
```

**ÐžÑ‚Ð²ÐµÑ‚:**
```json
[
  {
    "ID": "179fd8c2-37cb-4c7d-8d7b-7fe0fd564d7f",
    "Name": "Ð’Ð”ÐÐ¥",
    "Description": "Ð’Ñ‹ÑÑ‚Ð°Ð²ÐºÐ° Ð´Ð¾ÑÑ‚Ð¸Ð¶ÐµÐ½Ð¸Ð¹ Ð½Ð°Ñ€Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ñ…Ð¾Ð·ÑÐ¹ÑÑ‚Ð²Ð° Ð¡Ð¡Ð¡Ð ",
    "Latitude": 55.8304,
    "Longitude": 37.6325,
    "Epoch": "soviet",
    "Category": "architecture",
    "Importance": 10,
    "YearBuilt": 1939,
    "Architect": "Ð’ÑÑ‡ÐµÑÐ»Ð°Ð² ÐžÐ»Ñ‚Ð°Ñ€Ð¶ÐµÐ²ÑÐºÐ¸Ð¹",
    "Style": "Ð¡Ñ‚Ð°Ð»Ð¸Ð½ÑÐºÐ¸Ð¹ Ð°Ð¼Ð¿Ð¸Ñ€",
    "Photos": ["url1", "url2"]
  }
]
```

---

### 3. Ð”ÐµÑ‚Ð°Ð»Ð¸ Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð¼ÐµÑÑ‚Ð°

**Endpoint:** `GET /api/pois/:poi_id`

**ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ:** ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð´Ñ€Ð¾Ð±Ð½Ð¾Ð¹ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸ Ð¾ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð¼ Ð¼ÐµÑÑ‚Ðµ

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```bash
curl http://localhost:8080/api/pois/179fd8c2-37cb-4c7d-8d7b-7fe0fd564d7f
```

**ÐžÑ‚Ð²ÐµÑ‚:** ÐžÐ´Ð¸Ð½ Ð¾Ð±ÑŠÐµÐºÑ‚ POI

---

### 4. Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð°

**Endpoint:** `POST /api/routes/generate`

**ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ:** Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð° Ð½Ð° Ð¾ÑÐ½Ð¾Ð²Ðµ Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ñ‡Ñ‚ÐµÐ½Ð¸Ð¹

**Content-Type:** `application/json`

**Ð¢ÐµÐ»Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°:**
```json
{
  "start_point": {
    "lat": 55.7558,    // Ð¨Ð¸Ñ€Ð¾Ñ‚Ð° Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸
    "lon": 37.6173     // Ð”Ð¾Ð»Ð³Ð¾Ñ‚Ð° Ð½Ð°Ñ‡Ð°Ð»ÑŒÐ½Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸
  },
  "duration_minutes": 60,  // Ð”Ð»Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð¿Ñ€Ð¾Ð³ÑƒÐ»ÐºÐ¸ (15-180)
  "epochs": [              // Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ ÑÐ¿Ð¾Ñ…Ð¸ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
    "soviet",
    "medieval"
  ],
  "interests": [           // Ð˜Ð½Ñ‚ÐµÑ€ÐµÑÑ‹ (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
    "architecture",
    "history"
  ],
  "max_waypoints": 5       // ÐœÐ°ÐºÑÐ¸Ð¼ÑƒÐ¼ Ñ‚Ð¾Ñ‡ÐµÐº (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾, Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ 5)
}
```

**ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹:**

| ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ | Ð¢Ð¸Ð¿ | ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ |
|----------|-----|--------------|----------|
| start_point.lat | float | âœ… | Ð¨Ð¸Ñ€Ð¾Ñ‚Ð° (55.0 - 56.0 Ð´Ð»Ñ ÐœÐ¾ÑÐºÐ²Ñ‹) |
| start_point.lon | float | âœ… | Ð”Ð¾Ð»Ð³Ð¾Ñ‚Ð° (37.0 - 38.0 Ð´Ð»Ñ ÐœÐ¾ÑÐºÐ²Ñ‹) |
| duration_minutes | int | âœ… | 15-180 Ð¼Ð¸Ð½ÑƒÑ‚ |
| epochs | []string | âŒ | medieval, imperial, soviet, modern |
| interests | []string | âŒ | architecture, history, culture, religion, art |
| max_waypoints | int | âŒ | 1-10, Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ 5 |

**ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²:**

**Ð¡Ð¾Ð²ÐµÑ‚ÑÐºÐ°Ñ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° (60 Ð¼Ð¸Ð½ÑƒÑ‚):**
```bash
curl -X POST http://localhost:8080/api/routes/generate \
  -H "Content-Type: application/json" \
  -d '{
    "start_point": {"lat": 55.7558, "lon": 37.6173},
    "duration_minutes": 60,
    "epochs": ["soviet"],
    "interests": ["architecture"]
  }'
```

**Ð¡Ñ€ÐµÐ´Ð½ÐµÐ²ÐµÐºÐ¾Ð²Ð°Ñ Ð¸ÑÑ‚Ð¾Ñ€Ð¸Ñ (45 Ð¼Ð¸Ð½ÑƒÑ‚):**
```bash
curl -X POST http://localhost:8080/api/routes/generate \
  -H "Content-Type: application/json" \
  -d '{
    "start_point": {"lat": 55.7539, "lon": 37.6208},
    "duration_minutes": 45,
    "epochs": ["medieval"],
    "interests": ["history", "religion"]
  }'
```

**Ð¡Ð¼ÐµÑˆÐ°Ð½Ð½Ñ‹Ð¹ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚ (120 Ð¼Ð¸Ð½ÑƒÑ‚):**
```bash
curl -X POST http://localhost:8080/api/routes/generate \
  -H "Content-Type: application/json" \
  -d '{
    "start_point": {"lat": 55.7558, "lon": 37.6173},
    "duration_minutes": 120,
    "epochs": ["soviet", "medieval", "imperial"],
    "interests": ["architecture", "history", "art"],
    "max_waypoints": 8
  }'
```

**ÐžÑ‚Ð²ÐµÑ‚ (ÑÑ€Ð°Ð·Ñƒ Ð¿Ð¾ÑÐ»Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ):**
```json
{
  "route_id": "ea7a7092-8fa1-44c2-a656-55f38d4822e3",
  "name": "Ð¡Ð¾Ð²ÐµÑ‚ÑÐºÐ°Ñ ÐœÐ¾ÑÐºÐ²Ð°: ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°",
  "total_distance": 0,
  "estimated_duration": 60,
  "waypoints": [
    {
      "id": "7e127c92-12bb-4119-94dc-72b75abd1180",
      "name": "ÐšÑ€Ð°ÑÐ½Ð°Ñ Ð¿Ð»Ð¾Ñ‰Ð°Ð´ÑŒ",
      "description": "Ð“Ð»Ð°Ð²Ð½Ð°Ñ Ð¿Ð»Ð¾Ñ‰Ð°Ð´ÑŒ ÐœÐ¾ÑÐºÐ²Ñ‹",
      "coordinates": {
        "lat": 55.7539,
        "lon": 37.6208
      },
      "epoch": "medieval",
      "category": "history",
      "order": 1,
      "content": null  // Ð“ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾!
    },
    {
      "id": "3a3546bb-e90a-4455-b039-e56f75908b86",
      "name": "ÐšÑ€ÐµÐ¼Ð»ÑŒ",
      "description": "Ð”Ñ€ÐµÐ²Ð½ÑÑ ÐºÑ€ÐµÐ¿Ð¾ÑÑ‚ÑŒ",
      "coordinates": {
        "lat": 55.752,
        "lon": 37.6175
      },
      "epoch": "medieval",
      "category": "history",
      "order": 2,
      "content": null
    }
  ]
}
```

**Ð’Ð°Ð¶Ð½Ð¾:** `content` Ð±ÑƒÐ´ÐµÑ‚ `null` ÑÑ€Ð°Ð·Ñƒ Ð¿Ð¾ÑÐ»Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ, Ñ‚Ð°Ðº ÐºÐ°Ðº Ñ‚ÐµÐºÑÑ‚ Ð¸ Ð°ÑƒÐ´Ð¸Ð¾ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾ (1-2 Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹ Ð½Ð° Ñ‚Ð¾Ñ‡ÐºÑƒ).

---

### 5. ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð° Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð¾Ð¼

**Endpoint:** `GET /api/routes/:route_id`

**ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ:** ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»Ð½Ñ‹Ñ… Ð´ÐµÑ‚Ð°Ð»ÐµÐ¹ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð° (Ñ ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¼ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð¾Ð¼)

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```bash
# Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ route_id Ð¸Ð· Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ³Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°
curl http://localhost:8080/api/routes/ea7a7092-8fa1-44c2-a656-55f38d4822e3
```

**ÐžÑ‚Ð²ÐµÑ‚ (Ð¿Ð¾ÑÐ»Ðµ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð°):**
```json
{
  "route_id": "ea7a7092-8fa1-44c2-a656-55f38d4822e3",
  "name": "Ð¡Ð¾Ð²ÐµÑ‚ÑÐºÐ°Ñ ÐœÐ¾ÑÐºÐ²Ð°: ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°",
  "total_distance": 4500,
  "estimated_duration": 60,
  "waypoints": [
    {
      "id": "7e127c92-12bb-4119-94dc-72b75abd1180",
      "name": "ÐšÑ€Ð°ÑÐ½Ð°Ñ Ð¿Ð»Ð¾Ñ‰Ð°Ð´ÑŒ",
      "description": "Ð“Ð»Ð°Ð²Ð½Ð°Ñ Ð¿Ð»Ð¾Ñ‰Ð°Ð´ÑŒ ÐœÐ¾ÑÐºÐ²Ñ‹",
      "coordinates": {
        "lat": 55.7539,
        "lon": 37.6208
      },
      "epoch": "medieval",
      "category": "history",
      "order": 1,
      "content": {
        "text": "ÐŸÐµÑ€ÐµÐ´ Ð²Ð°Ð¼Ð¸ Ñ€Ð°ÑÐºÐ¸Ð½ÑƒÐ»Ð°ÑÑŒ Ð»ÐµÐ³ÐµÐ½Ð´Ð°Ñ€Ð½Ð°Ñ ÐšÑ€Ð°ÑÐ½Ð°Ñ Ð¿Ð»Ð¾Ñ‰Ð°Ð´ÑŒ...",
        "audio_url": "/api/audio/7e127c92-12bb-4119-94dc-72b75abd1180",
        "duration_seconds": 180,
        "photos": ["url1", "url2"]
      }
    }
  ]
}
```

**Ð•ÑÐ»Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ ÐµÑ‰Ðµ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ÑÑ:**
```json
{
  "waypoints": [{
    "content": null  // ÐŸÐ¾Ð´Ð¾Ð¶Ð´Ð¸Ñ‚Ðµ 1-2 Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹ Ð¸ Ð¿Ð¾Ð²Ñ‚Ð¾Ñ€Ð¸Ñ‚Ðµ Ð·Ð°Ð¿Ñ€Ð¾Ñ
  }]
}
```

---

### 6. Ð¡ÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ðµ Ð°ÑƒÐ´Ð¸Ð¾

**Endpoint:** `GET /api/audio/:waypoint_id`

**ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ:** ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ MP3 Ñ„Ð°Ð¹Ð»Ð° Ð´Ð»Ñ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð°

**ÐŸÑ€Ð¸Ð¼ÐµÑ€:**
```bash
# Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ Ð°ÑƒÐ´Ð¸Ð¾ Ð´Ð»Ñ Ð¿ÐµÑ€Ð²Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸
curl http://localhost:8080/api/audio/7e127c92-12bb-4119-94dc-72b75abd1180 \
  -o waypoint1.mp3

# Ð’Ð¾ÑÐ¿Ñ€Ð¾Ð¸Ð·Ð²ÐµÑÑ‚Ð¸ Ñ‡ÐµÑ€ÐµÐ· ffplay
ffplay waypoint1.mp3
```

**ÐžÑ‚Ð²ÐµÑ‚:** Binary MP3 file

**Headers:**
```
Content-Type: audio/mpeg
Content-Length: 245678
```

**ÐžÑˆÐ¸Ð±ÐºÐ¸:**
```json
// Ð•ÑÐ»Ð¸ Ð°ÑƒÐ´Ð¸Ð¾ ÐµÑ‰Ðµ Ð½Ðµ ÑÐ³ÐµÐ½ÐµÑ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¾
{
  "error": "Audio not generated yet"
}

// Ð•ÑÐ»Ð¸ waypoint Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½
{
  "error": "Audio not found"
}
```

---

## ðŸ’¾ Ð‘Ð°Ð·Ð° Ð”Ð°Ð½Ð½Ñ‹Ñ…

### Ð¡Ñ…ÐµÐ¼Ð° PostgreSQL

```sql
-- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ð¼ÐµÑÑ‚ Ð¸Ð½Ñ‚ÐµÑ€ÐµÑÐ°
CREATE TABLE pois (
    id            UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name          TEXT NOT NULL,
    description   TEXT,
    latitude      NUMERIC NOT NULL,
    longitude     NUMERIC NOT NULL,
    epoch         TEXT,              -- medieval, imperial, soviet, modern
    category      TEXT,              -- architecture, history, art, culture, religion
    importance    BIGINT DEFAULT 5,  -- 1-10
    year_built    BIGINT,
    architect     TEXT,
    style         TEXT,
    photos        TEXT[],            -- ÐœÐ°ÑÑÐ¸Ð² URL
    wikipedia_url TEXT,
    metadata      JSONB,
    created_at    TIMESTAMP DEFAULT NOW(),
    updated_at    TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_pois_epoch ON pois(epoch);
CREATE INDEX idx_pois_category ON pois(category);

-- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð¾Ð²
CREATE TABLE routes (
    id                 UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name               TEXT,
    description        TEXT,
    total_distance     NUMERIC,        -- Ð¼ÐµÑ‚Ñ€Ñ‹
    estimated_duration BIGINT,         -- Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹
    epochs             TEXT[],
    categories         TEXT[],
    created_at         TIMESTAMP DEFAULT NOW()
);

-- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° Ñ‚Ð¾Ñ‡ÐµÐº Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð°
CREATE TABLE waypoints (
    id         UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    route_id   UUID NOT NULL REFERENCES routes(id) ON DELETE CASCADE,
    poi_id     UUID NOT NULL REFERENCES pois(id),
    "order"    BIGINT NOT NULL,        -- ÐŸÐ¾Ñ€ÑÐ´Ð¾Ðº Ñ‚Ð¾Ñ‡ÐºÐ¸ (1, 2, 3...)
    created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_waypoints_route_id ON waypoints(route_id);

-- Ð¢Ð°Ð±Ð»Ð¸Ñ†Ð° ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð°
CREATE TABLE contents (
    id          UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    waypoint_id UUID NOT NULL UNIQUE REFERENCES waypoints(id) ON DELETE CASCADE,
    text        TEXT NOT NULL,
    audio_url   TEXT,
    audio_path  TEXT,
    duration    BIGINT,                -- ÑÐµÐºÑƒÐ½Ð´Ñ‹
    photos      TEXT[],
    generated   BOOLEAN DEFAULT FALSE,
    created_at  TIMESTAMP DEFAULT NOW()
);

CREATE UNIQUE INDEX idx_contents_waypoint_id ON contents(waypoint_id);
```

### Ð¡Ð²ÑÐ·Ð¸ Ð¼ÐµÐ¶Ð´Ñƒ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð°Ð¼Ð¸

```
pois (12 Ð·Ð°Ð¿Ð¸ÑÐµÐ¹)
  â”œâ”€ Ð’Ð”ÐÐ¥
  â”œâ”€ ÐœÐ“Ð£
  â”œâ”€ ÐžÑÑ‚Ð°Ð½ÐºÐ¸Ð½Ð¾
  â””â”€ ...

routes
  â””â”€ "Ð¡Ð¾Ð²ÐµÑ‚ÑÐºÐ°Ñ ÐœÐ¾ÑÐºÐ²Ð°"
      â”œâ”€ waypoints
      â”‚   â”œâ”€ waypoint_1 â†’ poi_id: Ð’Ð”ÐÐ¥ â†’ content_1
      â”‚   â”œâ”€ waypoint_2 â†’ poi_id: ÐœÐ“Ð£ â†’ content_2
      â”‚   â””â”€ waypoint_3 â†’ poi_id: ÐžÑÑ‚Ð°Ð½ÐºÐ¸Ð½Ð¾ â†’ content_3

contents
  â”œâ”€ content_1: text + audio Ð´Ð»Ñ Ð’Ð”ÐÐ¥
  â”œâ”€ content_2: text + audio Ð´Ð»Ñ ÐœÐ“Ð£
  â””â”€ content_3: text + audio Ð´Ð»Ñ ÐžÑÑ‚Ð°Ð½ÐºÐ¸Ð½Ð¾
```

### ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ðº Ð‘Ð”

**Ð’ÑÐµ ÑÐ¾Ð²ÐµÑ‚ÑÐºÐ¸Ðµ Ð¿Ð°Ð¼ÑÑ‚Ð½Ð¸ÐºÐ¸:**
```sql
SELECT name, latitude, longitude, year_built
FROM pois
WHERE epoch = 'soviet'
ORDER BY importance DESC;
```

**ÐœÐ°Ñ€ÑˆÑ€ÑƒÑ‚ Ñ Ñ‚Ð¾Ñ‡ÐºÐ°Ð¼Ð¸:**
```sql
SELECT
  r.name as route_name,
  w.order,
  p.name as poi_name,
  p.latitude,
  p.longitude
FROM routes r
JOIN waypoints w ON w.route_id = r.id
JOIN pois p ON p.id = w.poi_id
WHERE r.id = 'your-route-id'
ORDER BY w.order;
```

**Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¿Ð¾ ÑÐ¿Ð¾Ñ…Ð°Ð¼:**
```sql
SELECT epoch, COUNT(*) as count
FROM pois
GROUP BY epoch;
```

---

## ðŸš€ ÐšÐ°Ðº Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 1: ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ)

```bash
# 1. ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð² Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸ÑŽ backend
cd /Users/dimmy-kor/Projects/2gis_hackaton/backend

# 2. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
export DATABASE_URL="postgresql://nike:changeme@51.250.86.178:30101/audioguid?sslmode=disable"

# 3. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ ÑÐµÑ€Ð²ÐµÑ€
go run cmd/server/main.go
```

**Ð’Ñ‹Ð²Ð¾Ð´:**
```
2025/10/05 00:42:16 ðŸš€ Server starting on port 8080
[GIN-debug] GET    /api/health
[GIN-debug] POST   /api/routes/generate
[GIN-debug] GET    /api/routes/:route_id
[GIN-debug] GET    /api/pois
[GIN-debug] GET    /api/pois/:poi_id
[GIN-debug] GET    /api/audio/:waypoint_id
[GIN-debug] Listening and serving HTTP on :8080
```

**ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ°:**
```bash
curl http://localhost:8080/api/health
# {"status":"ok","message":"Audioguid API is running"}
```

---

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2: Ð¡ .env Ñ„Ð°Ð¹Ð»Ð¾Ð¼

```bash
cd /Users/dimmy-kor/Projects/2gis_hackaton/backend

# Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ .env Ñ„Ð°Ð¹Ð»
cat > .env << 'EOF'
# Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…
DATABASE_URL=postgresql://nike:changeme@51.250.86.178:30101/audioguid?sslmode=disable

# Yandex Cloud (Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð°)
YANDEX_API_KEY=your_api_key_here
YANDEX_FOLDER_ID=your_folder_id_here
YANDEX_VOICE=alena

# 2GIS
GAPIS_API_KEY=1bfdf79c-0a09-4ea6-882e-afc09421c8d5
GAPIS_APP_ID=ru.2gishackathon.app06.02
GAPIS_KEY_FILE=./keys/2gis.key

# Server
PORT=8080
EOF

# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ
go run cmd/server/main.go
```

---

### Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 3: ÐšÐ¾Ð¼Ð¿Ð¸Ð»ÑÑ†Ð¸Ñ Ð² Ð±Ð¸Ð½Ð°Ñ€Ð½Ð¸Ðº

```bash
cd /Users/dimmy-kor/Projects/2gis_hackaton/backend

# Ð¡ÐºÐ¾Ð¼Ð¿Ð¸Ð»Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ
go build -o audioguid cmd/server/main.go

# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ
export DATABASE_URL="postgresql://nike:changeme@51.250.86.178:30101/audioguid?sslmode=disable"
./audioguid
```

---

### ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ñ€ÐµÑÑ‚Ð°Ñ€Ñ‚ Ð¿Ñ€Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÑ… (Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸)

```bash
# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ air
go install github.com/cosmtrek/air@latest

# Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð¸Ð³
cat > .air.toml << 'EOF'
root = "."
tmp_dir = "tmp"

[build]
cmd = "go build -o ./tmp/main cmd/server/main.go"
bin = "tmp/main"
include_ext = ["go"]
exclude_dir = ["tmp", "vendor"]
EOF

# Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ hot-reload
air
```

---

## ðŸ“– ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ

### Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 1: Ð¡Ð¾Ð²ÐµÑ‚ÑÐºÐ°Ñ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° (60 Ð¼Ð¸Ð½ÑƒÑ‚)

```bash
# Ð¨Ð°Ð³ 1: Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚
ROUTE=$(curl -s -X POST http://localhost:8080/api/routes/generate \
  -H "Content-Type: application/json" \
  -d '{
    "start_point": {"lat": 55.7558, "lon": 37.6173},
    "duration_minutes": 60,
    "epochs": ["soviet"],
    "interests": ["architecture"],
    "max_waypoints": 3
  }')

# Ð¨Ð°Ð³ 2: ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ route_id
ROUTE_ID=$(echo $ROUTE | python3 -c "import sys,json; print(json.load(sys.stdin)['route_id'])")
echo "ÐœÐ°Ñ€ÑˆÑ€ÑƒÑ‚ ÑÐ¾Ð·Ð´Ð°Ð½: $ROUTE_ID"

# Ð¨Ð°Ð³ 3: ÐŸÐ¾Ð´Ð¾Ð¶Ð´Ð°Ñ‚ÑŒ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð°
echo "Ð–Ð´ÐµÐ¼ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð° (60 ÑÐµÐºÑƒÐ½Ð´)..."
sleep 60

# Ð¨Ð°Ð³ 4: ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð»Ð½Ñ‹Ð¹ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚
curl -s http://localhost:8080/api/routes/$ROUTE_ID | python3 -m json.tool

# Ð¨Ð°Ð³ 5: Ð¡ÐºÐ°Ñ‡Ð°Ñ‚ÑŒ Ð°ÑƒÐ´Ð¸Ð¾ Ð´Ð»Ñ Ð¿ÐµÑ€Ð²Ð¾Ð¹ Ñ‚Ð¾Ñ‡ÐºÐ¸
WAYPOINT_ID=$(curl -s http://localhost:8080/api/routes/$ROUTE_ID | \
  python3 -c "import sys,json; print(json.load(sys.stdin)['waypoints'][0]['id'])")

curl http://localhost:8080/api/audio/$WAYPOINT_ID -o waypoint1.mp3
echo "ÐÑƒÐ´Ð¸Ð¾ ÑÐ¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¾: waypoint1.mp3"
```

---

### Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 2: ÐŸÐ¾Ð¸ÑÐº Ð±Ð»Ð¸Ð¶Ð°Ð¹ÑˆÐ¸Ñ… Ð¼ÐµÑÑ‚

```bash
# ÐÐ°Ð¹Ñ‚Ð¸ ÑÐ¾Ð²ÐµÑ‚ÑÐºÑƒÑŽ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñƒ
curl -s "http://localhost:8080/api/pois?epoch=soviet&category=architecture" | \
  python3 -c "
import sys, json
data = json.load(sys.stdin)
for poi in data:
    print(f\"{poi['Name']}: {poi['Latitude']}, {poi['Longitude']}\")
"
```

**Ð’Ñ‹Ð²Ð¾Ð´:**
```
Ð’Ð”ÐÐ¥: 55.8304, 37.6325
ÐœÐ“Ð£ Ð¸Ð¼. Ðœ.Ð’. Ð›Ð¾Ð¼Ð¾Ð½Ð¾ÑÐ¾Ð²Ð°: 55.7033, 37.5297
ÐžÑÑ‚Ð°Ð½ÐºÐ¸Ð½ÑÐºÐ°Ñ Ñ‚ÐµÐ»ÐµÐ±Ð°ÑˆÐ½Ñ: 55.8194, 37.6119
Ð“Ð¾ÑÑ‚Ð¸Ð½Ð¸Ñ†Ð° 'Ð£ÐºÑ€Ð°Ð¸Ð½Ð°': 55.7526, 37.5676
```

---

### Ð¡Ñ†ÐµÐ½Ð°Ñ€Ð¸Ð¹ 3: Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð³Ð¾ POI

```bash
# Ð§ÐµÑ€ÐµÐ· psql
PGPASSWORD=changeme psql -h 51.250.86.178 -U nike -d audioguid << 'EOF'
INSERT INTO pois (name, description, latitude, longitude, epoch, category, importance, year_built)
VALUES (
  'ÐŸÐ°Ñ€Ðº ÐŸÐ¾Ð±ÐµÐ´Ñ‹',
  'ÐœÐµÐ¼Ð¾Ñ€Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ Ð¿Ð¾Ð±ÐµÐ´Ñ‹ Ð² Ð’ÐžÐ’',
  55.7325,
  37.5086,
  'soviet',
  'history',
  9,
  1995
);
EOF
```

Ð˜Ð»Ð¸ Ñ‡ÐµÑ€ÐµÐ· Python ÑÐºÑ€Ð¸Ð¿Ñ‚:
```python
# scripts/add_poi.py
import psycopg2

conn = psycopg2.connect(
    "postgresql://nike:changeme@51.250.86.178:30101/audioguid"
)
cursor = conn.cursor()

cursor.execute("""
    INSERT INTO pois (name, description, latitude, longitude, epoch, category, importance)
    VALUES (%s, %s, %s, %s, %s, %s, %s)
""", (
    "ÐŸÐ°Ñ€Ðº ÐŸÐ¾Ð±ÐµÐ´Ñ‹",
    "ÐœÐµÐ¼Ð¾Ñ€Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÐ¾Ð¼Ð¿Ð»ÐµÐºÑ",
    55.7325, 37.5086,
    "soviet", "history", 9
))

conn.commit()
print("âœ… POI Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½")
```

---

## ðŸ”§ Troubleshooting

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 1: "connection refused" Ð¿Ñ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐµ

**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°:** PostgreSQL Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:**
```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ
PGPASSWORD=changeme psql -h 51.250.86.178 -U nike -d audioguid -c "SELECT 1;"

# Ð•ÑÐ»Ð¸ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚, Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ:
# 1. IP Ð°Ð´Ñ€ÐµÑ ÑÐµÑ€Ð²ÐµÑ€Ð° (51.250.86.178)
# 2. ÐŸÐ¾Ñ€Ñ‚ (30101)
# 3. ÐŸÐ°Ñ€Ð¾Ð»ÑŒ (changeme)
# 4. Firewall rules Ð½Ð° VM
```

---

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 2: "Failed to create waypoints"

**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°:** ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ñ foreign key constraints

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:**
```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÑÑ…ÐµÐ¼Ñƒ
PGPASSWORD=changeme psql -h 51.250.86.178 -U nike -d audioguid -c "\d waypoints"

# ÐŸÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ constraint
PGPASSWORD=changeme psql -h 51.250.86.178 -U nike -d audioguid << 'EOF'
ALTER TABLE waypoints DROP CONSTRAINT IF EXISTS fk_waypoints_poi;
ALTER TABLE waypoints ADD CONSTRAINT fk_waypoints_poi 
  FOREIGN KEY (poi_id) REFERENCES pois(id);
EOF
```

---

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 3: "No POIs found"

**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°:** ÐÐµÑ‚ POI Ð² Ñ€Ð°Ð´Ð¸ÑƒÑÐµ Ð¿Ð¾Ð¸ÑÐºÐ°

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:**
```bash
# 1. Ð£Ð²ÐµÐ»Ð¸Ñ‡Ð¸Ñ‚ÑŒ duration_minutes (Ð±Ð¾Ð»ÑŒÑˆÐµ Ñ€Ð°Ð´Ð¸ÑƒÑ)
# 2. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ ÑˆÐ¸Ñ€Ðµ Ñ„Ð¸Ð»ÑŒÑ‚Ñ€Ñ‹ (Ð±Ð¾Ð»ÑŒÑˆÐµ epochs Ð¸ interests)
# 3. Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ start_point Ð±Ð»Ð¸Ð¶Ðµ Ðº POI

# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ POI
curl -s http://localhost:8080/api/pois | python3 -m json.tool | grep -A2 -B2 "Name"
```

---

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 4: "YandexGPT API error"

**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°:** ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ðµ Ð¸Ð»Ð¸ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ API ÐºÐ»ÑŽÑ‡Ð¸

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:**
```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
echo $YANDEX_API_KEY
echo $YANDEX_FOLDER_ID

# Ð•ÑÐ»Ð¸ Ð¿ÑƒÑÑ‚Ñ‹Ðµ, ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ:
export YANDEX_API_KEY="AQVN..."
export YANDEX_FOLDER_ID="b1g..."

# Ð˜Ð»Ð¸ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð² .env Ñ„Ð°Ð¹Ð»

# ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ API ÐºÐ»ÑŽÑ‡
curl -X POST https://llm.api.cloud.yandex.net/foundationModels/v1/completion \
  -H "Authorization: Api-Key $YANDEX_API_KEY" \
  -H "x-folder-id: $YANDEX_FOLDER_ID" \
  -H "Content-Type: application/json" \
  -d '{
    "modelUri": "gpt://'"$YANDEX_FOLDER_ID"'/yandexgpt/latest",
    "completionOptions": {"temperature": 0.7, "maxTokens": "100"},
    "messages": [{"role": "user", "text": "ÐŸÑ€Ð¸Ð²ÐµÑ‚!"}]
  }'
```

---

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 5: ÐšÐ¾Ð½Ñ‚ÐµÐ½Ñ‚ Ð½Ðµ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ÑÑ

**ÐŸÑ€Ð¸Ñ‡Ð¸Ð½Ð°:** Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ð¸Ð´ÐµÑ‚ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾, Ð½ÑƒÐ¶Ð½Ð¾ Ð¿Ð¾Ð´Ð¾Ð¶Ð´Ð°Ñ‚ÑŒ

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ:**
```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ ÑÑ‚Ð°Ñ‚ÑƒÑ Ñ‡ÐµÑ€ÐµÐ· 1-2 Ð¼Ð¸Ð½ÑƒÑ‚Ñ‹
curl -s http://localhost:8080/api/routes/$ROUTE_ID | \
  python3 -c "
import sys, json
data = json.load(sys.stdin)
for wp in data['waypoints']:
    status = 'âœ…' if wp.get('content') else 'â³'
    print(f\"{status} {wp['name']}: {wp.get('content', 'Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ÑÑ...')}\")
"
```

---

## ðŸ“Š ÐŸÐ¾Ð»ÐµÐ·Ð½Ñ‹Ðµ ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ° ÑÐµÑ€Ð²ÐµÑ€Ð°
```bash
curl http://localhost:8080/api/health
```

### ÐŸÐ¾Ð´ÑÑ‡ÐµÑ‚ POI Ð¿Ð¾ ÑÐ¿Ð¾Ñ…Ð°Ð¼
```bash
curl -s http://localhost:8080/api/pois | \
  python3 -c "
import sys, json
from collections import Counter
data = json.load(sys.stdin)
epochs = Counter(poi['Epoch'] for poi in data)
for epoch, count in epochs.items():
    print(f'{epoch}: {count}')
"
```

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ€Ð°Ð·Ð¼ÐµÑ€Ð° Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…
```bash
PGPASSWORD=changeme psql -h 51.250.86.178 -U nike -d audioguid -c "
SELECT
  tablename,
  pg_size_pretty(pg_total_relation_size(schemaname||'.'||tablename)) AS size
FROM pg_tables
WHERE schemaname = 'public'
ORDER BY pg_total_relation_size(schemaname||'.'||tablename) DESC;
"
```

### Ð›Ð¾Ð³Ð¸ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð°
```bash
# Ð’ ÐºÐ¾Ð´Ðµ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¾ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
tail -f /tmp/audioguid.log
```

---

## ðŸŽ“ Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ

### Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼Ñ‹Ðµ Ñ‚ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ð¸

- **Go 1.21+** - Ð¯Ð·Ñ‹Ðº Ð¿Ñ€Ð¾Ð³Ñ€Ð°Ð¼Ð¼Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
- **Gin Web Framework** - HTTP Ñ€Ð¾ÑƒÑ‚ÐµÑ€
- **GORM** - ORM Ð´Ð»Ñ PostgreSQL
- **PostgreSQL 16** - Ð‘Ð°Ð·Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…
- **2GIS API** - ÐšÐ°Ñ€Ñ‚Ñ‹ Ð¸ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ñ‹
- **YandexGPT** - Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ Ñ‚ÐµÐºÑÑ‚Ð°
- **Yandex SpeechKit** - Text-to-Speech

### ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ

| ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ | ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ | ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð° |
|------------|----------|-------------|
| DATABASE_URL | Connection string PostgreSQL | âœ… |
| YANDEX_API_KEY | API ÐºÐ»ÑŽÑ‡ Yandex Cloud | âŒ* |
| YANDEX_FOLDER_ID | Folder ID Yandex Cloud | âŒ* |
| YANDEX_VOICE | Ð“Ð¾Ð»Ð¾Ñ TTS (alena, filipp) | âŒ |
| GAPIS_API_KEY | API ÐºÐ»ÑŽÑ‡ 2GIS | âœ… |
| PORT | ÐŸÐ¾Ñ€Ñ‚ ÑÐµÑ€Ð²ÐµÑ€Ð° (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ 8080) | âŒ |

*Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹ Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð°

### Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Go

```go
require (
    github.com/gin-gonic/gin v1.9.1
    github.com/google/uuid v1.4.0
    github.com/joho/godotenv v1.5.1
    github.com/lib/pq v1.10.9
    gorm.io/driver/postgres v1.5.4
    gorm.io/gorm v1.25.5
)
```

---

**Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð°!** ðŸŽ‰

Ð”Ð»Ñ Ð²Ð¾Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð¸Ð»Ð¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼ ÑÐ¾Ð·Ð´Ð°Ð²Ð°Ð¹Ñ‚Ðµ issue Ð² Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¸.
